# Настройка загрузки изображений

## Описание

Система поддерживает загрузку изображений товаров через админ-панель. Изображения сохраняются на сервере и отображаются на фронтенде.

## Как это работает

### Backend (API)

1. **Маршрут загрузки**: `/api/upload/image` (POST, требует авторизации админа)
2. **Хранение файлов**: `backApi/uploads/` (создается автоматически)
3. **Статическая раздача**: `http://localhost:5001/uploads/filename.jpg`
4. **Ответ API**: Возвращает полный URL к загруженному изображению

```json
{
  "path": "http://localhost:5001/uploads/image-1234567890.jpg",
  "filename": "image-1234567890.jpg"
}
```

### Frontend

1. **Компонент загрузки**: В админ-панели `Menu.jsx` есть input для выбора файла
2. **Превью**: Отображается справа от формы в реальном времени
3. **Поддержка форматов**: Принимаются все изображения (image/*)
4. **Лимит размера**: До 5 МБ

### Утилита `getImageUrl()`

Создана универсальная функция `front/src/lib/imageUtils.js` для обработки путей:

- **Полные URL** (http://...) → возвращает как есть
- **Относительные пути** (/uploads/...) → добавляет базовый URL API

Это обеспечивает обратную совместимость со старыми записями в БД.

## Использование

### В компонентах

```jsx
import { getImageUrl } from "@/lib/imageUtils";

const imageUrl = getImageUrl(product.image);

<img src={imageUrl} alt={product.name} />
```

### В админ-панели

1. Откройте админ-панель → Меню
2. Создайте или отредактируйте товар
3. Нажмите "Выбрать файл" в поле "Фото товара"
4. Изображение автоматически загрузится и отобразится в превью
5. Сохраните товар

## Переменные окружения

### Frontend (`front/.env`)

```env
VITE_API_URL=http://localhost:5001
```

Эта переменная используется для формирования полных URL к изображениям.

## Проверка работоспособности

1. Запустите backend: `cd backApi && npm run dev`
2. Запустите frontend: `cd front && npm run dev`
3. Войдите в админ-панель
4. Попробуйте загрузить изображение товара
5. Проверьте, что изображение отображается в превью и на карточке товара

## Устранение проблем

### Изображения не отображаются

1. Проверьте, что папка `backApi/uploads/` существует и доступна для записи
2. Убедитесь, что backend раздает статику: `app.use("/uploads", express.static(...))`
3. Проверьте переменную `VITE_API_URL` в `front/.env`
4. Откройте DevTools → Network и посмотрите запросы к изображениям

### Ошибка при загрузке

1. Проверьте размер файла (максимум 5 МБ)
2. Убедитесь, что вы авторизованы как админ
3. Проверьте логи backend на наличие ошибок
4. Проверьте права доступа к папке `backApi/uploads/`

## Миграция старых данных

Если в БД есть записи с относительными путями (`/uploads/...`), они автоматически будут работать благодаря функции `getImageUrl()`, которая добавляет базовый URL.

Для миграции на полные URL можно запустить скрипт обновления товаров через админку или напрямую в MongoDB.

## Тестовые данные (Seed)

Для заполнения базы тестовыми данными с изображениями:

1. Убедитесь, что изображения скопированы в `backApi/uploads/`:
   ```bash
   cp front/public/images/card-*.png backApi/uploads/
   ```

2. Запустите seed:
   ```bash
   cd backApi
   npm run seed
   ```

3. Проверьте результат на http://localhost:5173

Подробнее см. [SEED_INSTRUCTIONS.md](./SEED_INSTRUCTIONS.md)
